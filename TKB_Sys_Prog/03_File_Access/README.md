# Tsukuba System Program

筑波大学／情報科学類 システムプログラム (2021年) の学習メモです。  

http://www.coins.tsukuba.ac.jp/~syspro/2021/  
http://www.coins.tsukuba.ac.jp/~syspro/2021/2021-04-28/index.html  
https://vimeo.com/channels/1707084  


## 第3週 ファイルアクセス

### 1. ファイルアクセス（基本）

ファイルディスクリプタ  

- 一時にオープンできるファイルの数（ファイルディスクリプタの最大値）は制限されている。  
- ulimit コマンドにより最大 10240 まで使用可能にできる。  

### 2. ファイルアクセス（応用）

ファイルのランダムアクセス  

- 全てをメモリ上に読み込むことが難しい大きなデータを扱う場合、必要なデータのみを読み書きすることになる。その場合、途中を読み飛ばすランダムアクセスができると効率が良い。  
- ランダムアクセスをするためには、lseek fseek を用いる。  

### 3. 構造体の入出力

ファイルのメモリマッピング  

- ファイルの内容にアクセスする方法として、ファイルをアドレス空間にマップするメモリマッピングと呼ばれるものがある。  
- ファイルの内容を配列のように扱うことができ、配列の添字やポインタを用いてファイルの読み書きをできるようになる。  
- メモリマッピングを行うためには、mmap システムコールを使用する。  
- munmap は、マップされた領域を解放する。  

### 4. ポインタ（3）

バッファへのポインタ  

- `fread()` `fwrite()` のバッファに、動的メモリを確保しないままのポインターをセットすると、有効なメモリ領域を指していない可能性が高いため、実行するとエラーになる可能性が高い。たとえエラーを出さずに実行できてしまったとしても、どこかの領域を破壊している可能性が高い。  
- そういうバグを含んでいてもコンパイルできてしまったりする。  
- 単純に cc や gcc コマンドをオプション無しで使用してコンパイルすると、何の警告も出力されないことが多い。  
- cc に -Wall というオプションを付けてコンパイルすると、buf が初期化されずに使用されているという警告が出力される。  
- できるだけオプションを指定するほうが良い。  

データ領域の種類と性質  

- グローバル変数が使用する領域は、プログラムの実行の開始から終了まで有効である。  
- ローカル変数が使用する領域は、その変数が宣言された関数が呼び出されてから呼び出し元に戻るまで有効である。スタック上に確保される。  
- ヒープ領域はプログラム実行開始後、必要な時に確保され不要になったら解放される領域であり、確保から解放まで有効である。領域が実行時に確保されるため、確保された領域を指し示す方法はポインタしかない。  

### 5. バッファオーバーフロー

この項目は中途半端にまとめず、テキストをちゃんと読んだほうが良い。  
関数の開始終了時のスタックの伸び縮み、配列参照失敗、そういうのは図を見たほうが理解しやすい。  

